"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=e(t),r=require("prosemirror-view"),i=require("prosemirror-state"),o=require("prosemirror-markdown"),a=require("lodash"),c=e(require("markdown-it/lib")),u=require("prosemirror-keymap"),s=require("prosemirror-commands"),l=require("prosemirror-history"),d=require("prosemirror-schema-list"),p=require("prosemirror-model"),f=require("prosemirror-inputrules"),m=require("prosemirror-utils"),h=e(require("lowlight/lib/core")),g=e(require("highlight.js/lib/languages/javascript")),v=e(require("highlight.js/lib/languages/python")),y=e(require("highlight.js/lib/languages/r")),k=e(require("highlight.js/lib/languages/css")),E=e(require("highlight.js/lib/languages/java")),b=e(require("classnames")),w=["horizontal_rule","hard_break"],M=["hr","hardbreak"],_={code:"backticks",heading:"heading",blockquote:"blockquote",code_block:"code",fence:"fence",bullet_list:"list",ordered_list:"list",hr:"hr",image:"image",link:"link"},x=function(e){var t=[].concat(M,e.disabledNodes,e.disabledMarks),n=a.omit(o.defaultMarkdownParser.tokens,t),r=c("commonmark",{html:!1}),i=a.compact(t.map((function(e){return _[e]})));return r.disable(i),new o.MarkdownParser(e,r,n)},C=function(){return o.defaultMarkdownSerializer.nodes.code_block=function(e,t){e.write("~~~"+(t.attrs.params||"")+"\n"),e.text(t.textContent,!1),e.ensureNewLine(),e.write("~~~"),e.closeBlock(t)},o.defaultMarkdownSerializer}(),N=function(e,t){return new i.Plugin({props:{attributes:{class:e,"data-placeholder":t}}})},T=function(e,t){return new i.Plugin({props:{clipboardTextParser:function(t){var n=x(e).parse(t).content;return p.Slice.maxOpen(n)},transformPastedHTML:function(e){return e.includes("<img src")?(t("Pasted content cannot contain images"),""):e}}})},I=function(e,t,n){return new f.InputRule(e,(function(e,r,i,o){var a=n instanceof Function?n(r):n,c=e.tr,u=r.length-1,s=o,l=i;if(r[u]){var d=i+r[0].indexOf(r[u-1]),p=d+r[u-1].length-1,f=d+r[u-1].lastIndexOf(r[u]),m=f+r[u].length;if(function(e,t,n){var r=[];return n.doc.nodesBetween(e,t,(function(e,t){r=[].concat(r,e.marks.map((function(n){return{start:t,end:t+e.nodeSize,mark:n}})))})),r}(i,o,e).filter((function(e){return e.mark.type.excludes(t)})).filter((function(e){return e.end>d})).length)return null;m<p&&c.delete(m,p),f>d&&c.delete(d,f),s=(l=d)+r[u].length}return c.addMark(l,s,t.create(a)),c.removeStoredMark(t),c}))},L=function(e,t){return new f.InputRule(e,(function(e,n,r,i){var o=e.tr.insertText(n[1],r,i),a=t.create({href:n[2],title:n[3]});return o.addMark(r,r+n[1].length,a)}))},q=function(e,t,n){void 0===n&&(n={});var r=m.findSelectedNodeOfType(t)(e.selection)||m.findParentNode((function(e){return e.type===t}))(e.selection);return Object.keys(n).length&&r?{isActive:r.node.hasMarkup(t,n),node:r.node}:{isActive:!!r,node:null==r?void 0:r.node}},S=function(e,t,n,r){return void 0===r&&(r={}),function(i,o){var a=q(i,e,r),c=a.node;return a.isActive?e===n.nodes.code_block&&(null==c?void 0:c.textContent.length)?s.exitCode(i,o):s.setBlockType(t)(i,o):s.setBlockType(e,r)(i,o)}},P=function(e,t){return e.type===t.nodes.bullet_list||e.type===t.nodes.ordered_list||e.type===t.nodes.todo_list},B=function(e,t){return function(n,r){var i=n.schema,o=n.selection,a=o.$from.blockRange(o.$to);if(!a)return!1;var c=m.findParentNode((function(e){return P(e,i)}))(o);if(a.depth>=1&&c&&a.depth-c.depth<=1){if(c.node.type===e)return d.liftListItem(t)(n,r);if(P(c.node,i)&&e.validContent(c.node.content)){var u=n.tr;return u.setNodeMarkup(c.pos,e),r&&r(u),!1}}return d.wrapInList(e)(n,r)}},O=function(){function e(e,t,n){this.items=e,this.editorView=t,this.onUpdate=n}var t=e.prototype;return t.markActive=function(e){var t=this.editorView.state;return e instanceof p.NodeType?q(t,e).isActive:function(e,t){var n=e.selection,r=n.from,i=n.to;return n.empty?!!t.isInSet(e.storedMarks||n.$from.marks()):!!e.doc.rangeHasMark(r,i,t)}(t,e)},t.update=function(){var e=this,t=this.items.filter((function(t){return e.markActive(t.type)}));this.onUpdate(t.length?t.map((function(e){return e.name})):[])},t.destroy=function(){this.onUpdate([])},e}(),j=new i.Plugin({state:{init:function(){return r.DecorationSet.empty},apply:function(e,t){t=t.map(e.mapping,e.doc);var n=e.getMeta(this);if(n&&n.add){var i=document.createElement("div");i.className="image__placeholder";var o=document.createElement("div");o.className="loader",i.appendChild(o);var a=r.Decoration.widget(n.add.pos,i,{id:n.add.id});t=t.add(e.doc,[a])}else n&&n.remove&&(t=t.remove(t.find(void 0,void 0,(function(e){return e.id===n.remove.id}))));return t}},props:{decorations:function(e){return this.getState(e)}}}),z=function(e,t,n,r,i){var o={};if(!window.confirm("I am authorised to use this content"))return!1;var a=e.state.tr;a.setMeta(j,{add:{id:o,pos:r}}),a.setSelection(a.selection),e.dispatch(a);var c=e.state.schema;return t.forEach((function(t){var r=function(e,t){var n=j.getState(e).find(void 0,void 0,(function(e){return e.id===t}));return n.length?n[0].from:null}(e.state,o);if(r){var a=new FormData;a.append("image",t);var u=new XMLHttpRequest;u.withCredentials=!0,u.open("POST",n.url,!0),u.setRequestHeader("X-CSRF-TOKEN",n.csrfToken),u.onerror=function(){var t=e.state.tr.setMeta(j,{remove:{id:o}});i("Sorry something went wrong"),e.dispatch(t)},u.onload=function(){var t,n;try{n=JSON.parse(u.response)}catch(e){n={errors:"Sorry something went wrong"}}if([200,201].includes(u.status)){var a=c.nodes.image.create({src:n.data.url});t=e.state.tr.replaceWith(r,r,a).setMeta(j,{remove:{id:o}})}else t=e.state.tr.setMeta(j,{remove:{id:o}}),i(n.errors);e.dispatch(t)},u.send(a)}})),!0};function A(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function H(e,t,n){return t&&A(e.prototype,t),n&&A(e,n),e}function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function V(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function R(e){var t=e.doc,n=e.name,i=[],o=[];return m.findBlockNodes(t).filter((function(e){return e.node.type.name===n})).forEach((function(e){var t=e.pos+1,n=h.highlightAuto(e.node.textContent),c=n.value,u=n.language;n.relevance>1&&(u&&u!==e.node.attrs.params&&o.push({language:u,pos:e.pos,type:e.node.type}),a.flattenDeep(function e(t,n){return void 0===n&&(n=[]),t.map((function(t){var r=[].concat(n,t.properties?t.properties.className:[]);return t.children?e(t.children,r):{text:t.value,classes:r}}))}(c)).map((function(e){var n=t,r=n+e.text.length;return t=r,$({},e,{from:n,to:r})})).forEach((function(e){var t=r.Decoration.inline(e.from,e.to,{class:e.classes.join(" ")});i.push(t)})))})),{decorations:r.DecorationSet.create(t,i),languages:o}}var U=function(){function e(e){this.schema=e}var t=e.prototype;return t.getPlugins=function(){return this._type?[u.keymap(this.shortcuts),f.inputRules({rules:this.rules})]:[]},t.getToolbarItem=function(){return this._type&&this.inToolbar&&this.command?{name:this.name,icon:this.icon,command:this.command,type:this.type}:null},H(e,[{key:"name",get:function(){return""}},{key:"icon",get:function(){return""}},{key:"inToolbar",get:function(){return!0}},{key:"command",get:function(){return function(e,t){}}},{key:"shortcuts",get:function(){return{}}},{key:"rules",get:function(){return[]}},{key:"type",get:function(){return this._type}},{key:"_type",get:function(){return null}}]),e}(),D=function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"type",get:function(){return this._type}},{key:"_type",get:function(){return this.schema.marks[this.name]}}]),t}(U),F=/(https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\\+.~#?&//=]*))\s$/g,K=/\[(.+)\]\((https?[^ ]+)(?: "(.+)")?\)$/,X=[function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"strong"}},{key:"icon",get:function(){return"Bold"}},{key:"command",get:function(){return s.toggleMark(this.type)}},{key:"shortcuts",get:function(){return{"Mod-b":s.toggleMark(this.type),"Mod-B":s.toggleMark(this.type)}}},{key:"rules",get:function(){return[I(/(?:\*\*|__)([^*_]+)(?:\*\*|__)$/,this.type)]}}]),t}(D),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"em"}},{key:"icon",get:function(){return"Italic"}},{key:"shortcuts",get:function(){return{"Mod-i":s.toggleMark(this.type),"Mod-I":s.toggleMark(this.type)}}},{key:"rules",get:function(){return[I(/(?:^|[^_])(_([^_]+)_)$/,this.type),I(/(?:^|[^*])(\*([^*]+)\*)$/,this.type)]}},{key:"command",get:function(){return s.toggleMark(this.type)}}]),t}(D),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"code"}},{key:"icon",get:function(){return"Code"}},{key:"shortcuts",get:function(){return{"Mod-`":s.toggleMark(this.type)}}},{key:"rules",get:function(){return[I(/(?:`)([^`]+)(?:`)$/,this.type)]}},{key:"command",get:function(){return s.toggleMark(this.type)}}]),t}(D),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"link"}},{key:"rules",get:function(){return[(e=F,t=this.type,new f.InputRule(e,(function(e,n,r,i){var o=e.tr.insertText(n[0],r,i),a=t.create({href:n[1]});return o.addMark(r,r+n[1].length,a)}))),L(K,this.type)];var e,t}},{key:"inToolbar",get:function(){return!1}}]),t}(D)],Q=function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"type",get:function(){return this._type}},{key:"_type",get:function(){return this.schema.nodes[this.name]}},{key:"paragraphType",get:function(){return this.schema.nodes.paragraph}},{key:"listItemType",get:function(){return this.schema.nodes.list_item}}]),t}(U),W=[1,2,3,4,5,6],Z=[function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"blockquote"}},{key:"icon",get:function(){return"Quote"}},{key:"command",get:function(){return e=this.type,function(t,n){return q(t,e).isActive?s.lift(t,n):s.wrapIn(e)(t,n)};var e}},{key:"rules",get:function(){return[f.wrappingInputRule(/^\s*>\s$/,this.type)]}}]),t}(Q),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"heading"}},{key:"icon",get:function(){return"Heading"}},{key:"command",get:function(){return S(this.type,this.paragraphType,this.schema)}},{key:"rules",get:function(){var e=this;return W.map((function(t){return f.textblockTypeInputRule(new RegExp("^(#{1,"+t+"})\\s$"),e.type,(function(){return{level:t}}))}))}}]),t}(Q),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"bullet_list"}},{key:"icon",get:function(){return"UnorderedList"}},{key:"command",get:function(){return B(this.type,this.listItemType)}},{key:"rules",get:function(){return[f.wrappingInputRule(/^\s*([-+*])\s$/,this.type)]}}]),t}(Q),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"ordered_list"}},{key:"icon",get:function(){return"OrderedList"}},{key:"command",get:function(){return B(this.type,this.listItemType)}},{key:"rules",get:function(){return[f.wrappingInputRule(/^(\d+)\.\s$/,this.type,(function(e){return{order:+e[1]}}),(function(e,t){return t.childCount+t.attrs.order===+e[1]}))]}}]),t}(Q),function(e){function t(){return e.apply(this,arguments)||this}return V(t,e),H(t,[{key:"name",get:function(){return"code_block"}},{key:"icon",get:function(){return"CodeBlock"}},{key:"command",get:function(){return S(this.type,this.paragraphType,this.schema)}},{key:"rules",get:function(){return[f.textblockTypeInputRule(/^(```|~~~)$/,this.type)]}}]),t}(Q)],J=function(e){return[].concat(function(e){return a.compact(X.map((function(t){return new t(e).getToolbarItem()})))}(e),function(e){return a.compact(Z.map((function(t){return new t(e).getToolbarItem()})))}(e))},Y={Bold:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--bold",viewBox:"0 0 32 32"},n.createElement("path",{d:"M24.2,17.4c-0.9-0.9-2-1.7-3.3-2.1c1.8-1,3.6-3,3.6-6.7c0-0.1,0.2-3.5-2.1-5.9C20.8,0.9,18.5,0,15.5,0H9v0H7\n  v32h0.8v0H16c0.1,0,0.1,0,0.2,0c1.5,0,5.3-0.1,7.8-2.6c1.5-1.5,2.3-3.6,2.3-6.1C26.3,22.8,26.4,19.8,24.2,17.4z M15.5,2\n  c2.4,0,4.2,0.6,5.4,1.9c1.7,1.8,1.6,4.4,1.6,4.5c0,2.6-1,4.3-3,5.3c-1.1,0.5-2.4,0.8-4,0.8H9V2H15.5z M24.2,23.1l0,0.1\n  c0,2-0.6,3.6-1.7,4.8c-2,2-5.5,2-6.6,2H9V16.5h6.8c3.2-0.1,5.5,0.7,6.9,2.2C24.4,20.6,24.2,23.1,24.2,23.1z"}))},Code:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--code",viewBox:"0 0 32 32"},n.createElement("polygon",{points:"13.1,6.7 11.6,5.3 1,16 11.7,26.7 13.1,25.3 3.8,16 "}),n.createElement("polygon",{points:"20.4,5.3 19,6.7 28.2,16 19,25.3 20.4,26.7 31,16 "}))},CodeBlock:function(){return n.createElement("svg",{viewBox:"0 0 32 32"},n.createElement("path",{fill:"#3A343A",d:"M11.97,1.02L10.69,1v0C10.47,1,8.7,0.85,7.48,1.96c-0.6,0.55-0.92,1.31-0.92,2.2v9.66  c0,0.42-0.15,0.6-0.27,0.72C5.77,15.06,3.97,15,3.97,15v2c0,0,1.79-0.07,2.33,0.46c0.12,0.12,0.27,0.3,0.27,0.72v9.66  c0,0.89,0.32,1.65,0.92,2.2C8.7,31.15,10.47,31,10.69,31v0l1.28-0.02V29L10.69,29c-0.33,0.02-1.38,0-1.86-0.44  c-0.12-0.11-0.27-0.3-0.27-0.72v-9.66c0-0.87-0.31-1.63-0.9-2.18c0.58-0.55,0.9-1.31,0.9-2.18V4.16c0-0.42,0.14-0.61,0.27-0.72  C9.31,2.99,10.36,2.97,10.69,3v0L11.97,3V1.02z"}),n.createElement("path",{fill:"#3A343A",d:"M19.98,1.02L21.26,1v0c0.22,0,1.99-0.15,3.21,0.97c0.6,0.55,0.92,1.31,0.92,2.2v9.66  c0,0.42,0.15,0.6,0.27,0.72c0.52,0.52,2.33,0.46,2.33,0.46v2c0,0-1.79-0.07-2.33,0.46c-0.12,0.12-0.27,0.3-0.27,0.72v9.66  c0,0.89-0.32,1.65-0.92,2.2C23.25,31.15,21.49,31,21.26,31v0l-1.28-0.02V29L21.26,29c0.33,0.02,1.38,0,1.86-0.44  c0.12-0.11,0.27-0.3,0.27-0.72v-9.66c0-0.87,0.31-1.63,0.9-2.18c-0.58-0.55-0.9-1.31-0.9-2.18V4.16c0-0.42-0.14-0.61-0.27-0.72  C22.64,2.99,21.59,2.97,21.26,3v0L19.98,3V1.02z"}))},Heading:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--heading",viewBox:"0 0 32 32"},n.createElement("polygon",{points:"25,0 25,15 7,15 7,0 5,0 5,32 7,32 7,17 25,17 25,32 27,32 27,0 "}))},Image:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--italic",viewBox:"0 0 32 32"},n.createElement("circle",{cx:"21.5",cy:"11.5",r:"4.5"}),n.createElement("polygon",{points:"32,6 32,0 0,0 0,32 32,32 32,11 30,11 30,30 16,20 2,30 2,2 30,2 30,6"}))},Italic:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--italic",viewBox:"0 0 32 32"},n.createElement("polygon",{points:"25.3,2 25.3,0 13.3,0 13.3,2 18.1,2 12.2,30 7,30 7,32 19,32 19,30 14.2,30 20.1,2 "}))},OrderedList:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--ordered-list",viewBox:"0 0 32 32"},n.createElement("rect",{x:"10",y:"3",width:"22",height:"2"}),n.createElement("rect",{x:"10",y:"15",width:"22",height:"2"}),n.createElement("rect",{x:"10",y:"27",width:"22",height:"2"}),n.createElement("path",{d:"M3.8,25.1c-1,0-1.3,0.8-1.3,0.8l-1.3-0.7c0,0,0.7-1.6,2.7-1.6c1.5,0,2.9,0.8,2.9,2.4c0,1.1-0.9,1.4-0.9,1.4\n    s1,0.4,1,1.7c0,1.6-1.4,2.4-2.9,2.4c-2.2,0-2.8-1.8-2.8-1.8l1.4-0.8c0,0,0.3,1.1,1.4,1.1c0.7,0,1-0.4,1-0.9c0-0.6-0.5-0.9-1.3-0.9\n    H3.3v-1.3h0.3c0.6,0,1.3-0.2,1.3-0.9C4.9,25.5,4.5,25.1,3.8,25.1z"}),n.createElement("path",{d:"M4.1,16C4.4,15.6,5,15,5,14.3c0-0.6-0.5-1.1-1.2-1.1c-1,0-1.3,1.1-1.3,1.1L1,13.8c0,0,0.6-2.3,2.8-2.3\n    c2,0,3,1.4,3,2.7c0,0.8-0.4,1.5-0.6,1.7L4.7,18h2.2v1.6H1.1L4.1,16z"}),n.createElement("path",{d:"M4.4,0.6H6v7.9H4.2V2.9L2.4,4.5l-1-1.3L4.4,0.6z"}))},Quote:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--quote",viewBox:"0 0 32 32"},n.createElement("path",{d:"M11.1,26V15.9H5.6C6,12.3,8.3,9.5,12,9.5V5.8c-5.8,0-10.5,4.4-11,10.1l0,0V26H11.1z"}),n.createElement("path",{d:"M20.9,5.8v10.1h5.5c-0.5,3.6-2.7,6.4-6.4,6.4V26c5.8,0,10.5-4.4,11-10.1l0,0V5.8L20.9,5.8z"}))},UnorderedList:function(){return n.createElement("svg",{className:"a-svg-icon a-svg-icon--unordered-list",viewBox:"0 0 32 32"},n.createElement("circle",{cx:"2.5",cy:"4",r:"2.5"}),n.createElement("circle",{cx:"2.5",cy:"16",r:"2.5"}),n.createElement("circle",{cx:"2.5",cy:"28",r:"2.5"}),n.createElement("rect",{x:"8",y:"3",width:"24",height:"2"}),n.createElement("rect",{x:"8",y:"15",width:"24",height:"2"}),n.createElement("rect",{x:"8",y:"27",width:"24",height:"2"}))}},G=function(e){var t=e.onClick,r=e.name,i=Y[e.icon];return n.createElement("button",{className:b("item",{"item--active":e.isActive}),"data-item":r,onClick:t,type:"button"},n.createElement(i,null))},ee=function(e){var t=e.editor,r=e.imageUploadEndpoint,i=e.onError;return n.createElement("div",{className:"fileUploadWrapper"},n.createElement("button",{"data-item":"image",className:"item"},n.createElement(Y.Image,null)),n.createElement("input",{type:"file",accept:".jpg,.jpeg,.png,.gif",onChange:function(e){if(r&&t&&e.target){var n=e.target;n.files&&(e.preventDefault(),z(t,Array.from(n.files),r,t.state.tr.selection.from,i),t.focus(),n.value="")}}}))},te=function(e){var r=e.onClick,i=e.activeOptions,o=e.editor,a=e.imageUploadEndpoint,c=e.disabledItems,u=void 0===c?[]:c,s=e.onError,l=t.useMemo((function(){return J(o.state.schema).filter((function(e){return!u.includes(e.name)}))}),[u,o.state.schema]);return n.createElement("div",{className:"toolbar"},l.map((function(e){return n.createElement(G,{key:e.name,icon:e.icon,name:e.name,onClick:function(){return r(e)},isActive:i.includes(e.name)})})),!u.includes("image")&&n.createElement(ee,{editor:o,imageUploadEndpoint:a,onError:s}))},ne=function(e){var t={code_block:"Hold down shift and press enter to exit the code block"};return n.createElement("p",null,e.activeOptions.map((function(e){return t[e]})))};exports.default=function(e){var c=e.id,p=e.name,f=e.onChange,m=void 0===f?function(){}:f,M=e.value,_=void 0===M?"":M,I=e.placeholder,L=void 0===I?"Enter text":I,q=e.classes,S=void 0===q?"rich-text-editor":q,P=e.imageUploadEndpoint,B=e.onError,A=void 0===B?function(){}:B,H=e.disabledMarks,$=void 0===H?[]:H,V=e.disabledNodes,U=void 0===V?[]:V,D=t.useRef(null),F=t.useState(null),K=F[0],Q=F[1],W=t.useState(_),Y=W[0],G=W[1],ee=t.useState([]),re=ee[0],ie=ee[1],oe=function(e){G(e),m(e)},ae=function(){if(D.current){var e=function(e){var t,n,c,p=e.node,f=e.value,m=e.onChange,b=e.classes,M=e.placeholder,_=e.onToolbarChange,I=e.imageUploadEndpoint,L=e.onError,q=function(e){var t=e.disabledMarks,n=void 0===t?[]:t,r=e.disabledNodes,i=void 0===r?[]:r;return i.includes("code_block")?i.push("fence"):o.schema.nodes.code_block.isolating=!0,o.schema.nodes=a.omit(o.schema.nodes,[].concat(w,i)),o.schema.marks=a.omit(o.schema.marks,n),o.schema.disabledNodes=i,o.schema.disabledMarks=n,o.schema}({disabledMarks:e.disabledMarks,disabledNodes:e.disabledNodes}),S=q.nodes.list_item,P=[l.history(),u.keymap({"Mod-z":l.undo,"Mod-y":l.redo,Enter:d.splitListItem(S),Backspace:function(e,t){var n=e.selection.$from.parent;return!(![q.nodes.heading,q.nodes.code_block].includes(n.type)||n.textContent.length||(s.setBlockType(q.nodes.paragraph)(e,t),0))}}),u.keymap({"Shift-Enter":s.exitCode}),u.keymap(s.baseKeymap),T(q,L),(t=J(q),n=_,new i.Plugin({view:function(e){return new O(t,e,n)}}))].concat(function(e){return a.flatMap(X,(function(t){return new t(e).getPlugins()}))}(q),function(e){return a.flatMap(Z,(function(t){return new t(e).getPlugins()}))}(q),[N(b,M)]);q.nodes.code_block&&P.push((c=q.nodes.code_block.name,h.registerLanguage("javascript",g),h.registerLanguage("python",v),h.registerLanguage("r",y),h.registerLanguage("css",k),h.registerLanguage("java",E),new i.Plugin({key:new i.PluginKey("highlight"),state:{init:function(e,t){return R({doc:t.doc,name:c})},apply:function(e,t,n,r){return e.docChanged&&[r.selection.$head.parent.type.name,n.selection.$head.parent.type.name].includes(c)?R({doc:e.doc,name:c}):(t.decorations||t).map(e.mapping,e.doc)}},props:{decorations:function(e){var t=this.getState(e);return t.decorations||t}},view:function(e){return{update:function(e,t){var n=t.highlight$&&t.highlight$.languages;n&&n.length&&n.forEach((function(t){var n=e.state.tr.setNodeMarkup(t.pos,t.type,{params:t.language});e.dispatch(n)}))}}}}))),I&&q.nodes.image&&P.push(j,function(e,t){return new i.Plugin({props:{handleDOMEvents:{drop:function(n,r){var i=r;if(!i.dataTransfer)return!1;if(!i.dataTransfer.files||!i.dataTransfer.files.length)return!1;var o=Array.from(i.dataTransfer.files).filter((function(e){return/image/i.test(e.type)}));if(0===o.length)return!1;r.preventDefault();var a=n.posAtCoords({left:i.clientX,top:i.clientY});return!!a&&z(n,o,e,a.pos,t)}}}})}(I,L));var B=new r.EditorView(p,{state:i.EditorState.create({schema:q,doc:x(q).parse(f),plugins:P}),dispatchTransaction:function(e){var t=B.state.apply(e);B.updateState(t),m(C.serialize(B.state.doc))}});return B}({node:D.current,value:_,onChange:oe,classes:S,placeholder:L,onToolbarChange:function(e){return ie(e)},imageUploadEndpoint:P,onError:A,disabledNodes:U,disabledMarks:$});Q(e)}};return t.useEffect((function(){_!==Y&&K&&(K.destroy(),ae())}),[_]),t.useEffect((function(){ae()}),[]),n.createElement(n.Fragment,null,K&&n.createElement(te,{activeOptions:re,onClick:function(e){var t=e.command;K&&(K.focus(),t(K.state,K.dispatch,K))},editor:K,disabledItems:[].concat($,U),imageUploadEndpoint:P,onError:A}),n.createElement("div",{id:c,className:b({hasPlaceholder:!Y.length}),ref:D}),n.createElement(ne,{activeOptions:re}),n.createElement("input",{type:"hidden",value:Y,onChange:function(){},name:p}))};
//# sourceMappingURL=markdown-editor.cjs.production.min.js.map
