{"version":3,"file":"markdown-editor.cjs.production.min.js","sources":["../src/Editor/schema.js","../src/Editor/markdown.ts","../src/Editor/Plugins/editor.ts","../src/Editor/Plugins/paste.ts","../src/Editor/utils/markInputRule.ts","../src/Editor/utils/markdownLinkInputRule.ts","../src/Editor/utils/nodeIsActive.ts","../src/Editor/utils/toggleBlockType.ts","../src/Editor/utils/toggleList.ts","../src/Editor/Plugins/menu.ts","../src/Editor/utils/markIsActive.ts","../src/Editor/Plugins/placeholder.ts","../src/Editor/Plugins/fileUpload.ts","../src/Editor/Plugins/highlight.ts","../src/Editor/BaseType.ts","../src/Editor/Marks/Mark.ts","../src/Editor/Marks/Link.ts","../src/Editor/Marks/index.ts","../src/Editor/Marks/Strong.ts","../src/Editor/Marks/Emphasis.ts","../src/Editor/Marks/InlineCode.ts","../src/Editor/utils/linkInputRule.ts","../src/Editor/Nodes/Node.ts","../src/Editor/Nodes/Heading.ts","../src/Editor/Nodes/index.ts","../src/Editor/Nodes/Blockquote.ts","../src/Editor/utils/toggleWrap.ts","../src/Editor/Nodes/BulletList.ts","../src/Editor/Nodes/OrderedList.ts","../src/Editor/Nodes/CodeBlock.ts","../src/Toolbar/menuItems.ts","../src/Icons/index.ts","../src/Icons/Bold.tsx","../src/Icons/Code.tsx","../src/Icons/CodeBlock.tsx","../src/Icons/Heading.tsx","../src/Icons/Image.tsx","../src/Icons/Italic.tsx","../src/Icons/OrderedList.tsx","../src/Icons/Quote.tsx","../src/Icons/UnorderedList.tsx","../src/Toolbar/Item.tsx","../src/Toolbar/ImageUpload.tsx","../src/Toolbar/index.tsx","../src/ContextualHelp/index.tsx","../src/index.tsx","../src/Editor/View.ts","../src/Editor/Plugins/imageDrop.ts"],"sourcesContent":["import { Schema } from 'prosemirror-model';\n\n// ::Schema Document schema for the data model used by CommonMark.\nexport default new Schema({\n  nodes: {\n    doc: {\n      content: 'block+',\n    },\n\n    paragraph: {\n      content: 'inline*',\n      group: 'block',\n      parseDOM: [{ tag: 'p' }],\n      toDOM() {\n        return ['p', 0];\n      },\n    },\n\n    blockquote: {\n      content: 'block+',\n      group: 'block',\n      parseDOM: [{ tag: 'blockquote' }],\n      toDOM() {\n        return ['blockquote', 0];\n      },\n    },\n\n    horizontal_rule: {\n      group: 'block',\n      parseDOM: [{ tag: 'hr' }],\n      toDOM() {\n        return ['div', ['hr']];\n      },\n    },\n\n    heading: {\n      attrs: { level: { default: 1 } },\n      content: 'inline*',\n      group: 'block',\n      defining: true,\n      parseDOM: [\n        { tag: 'h1', attrs: { level: 1 } },\n        { tag: 'h2', attrs: { level: 2 } },\n        { tag: 'h3', attrs: { level: 3 } },\n        { tag: 'h4', attrs: { level: 4 } },\n        { tag: 'h5', attrs: { level: 5 } },\n        { tag: 'h6', attrs: { level: 6 } },\n      ],\n      toDOM(node) {\n        return ['h' + node.attrs.level, 0];\n      },\n    },\n\n    code_block: {\n      content: 'text*',\n      group: 'block',\n      code: true,\n      isolating: true,\n      defining: true,\n      marks: '',\n      attrs: { params: { default: '' } },\n      parseDOM: [\n        {\n          tag: 'pre',\n          preserveWhitespace: 'full',\n          getAttrs: node => ({\n            params: node.getAttribute('data-params') || '',\n          }),\n        },\n      ],\n      toDOM(node) {\n        return [\n          'pre',\n          node.attrs.params ? { 'data-params': node.attrs.params } : {},\n          ['code', 0],\n        ];\n      },\n    },\n\n    ordered_list: {\n      content: 'list_item+',\n      group: 'block',\n      attrs: { order: { default: 1 }, tight: { default: false } },\n      parseDOM: [\n        {\n          tag: 'ol',\n          getAttrs(dom) {\n            return {\n              order: dom.hasAttribute('start') ? +dom.getAttribute('start') : 1,\n              tight: dom.hasAttribute('data-tight'),\n            };\n          },\n        },\n      ],\n      toDOM(node) {\n        return [\n          'ol',\n          {\n            start: node.attrs.order == 1 ? null : node.attrs.order,\n            'data-tight': node.attrs.tight ? 'true' : null,\n          },\n          0,\n        ];\n      },\n    },\n\n    bullet_list: {\n      content: 'list_item+',\n      group: 'block',\n      attrs: { tight: { default: false } },\n      parseDOM: [\n        {\n          tag: 'ul',\n          getAttrs: dom => ({ tight: dom.hasAttribute('data-tight') }),\n        },\n      ],\n      toDOM(node) {\n        return ['ul', { 'data-tight': node.attrs.tight ? 'true' : null }, 0];\n      },\n    },\n\n    list_item: {\n      content: 'paragraph block*',\n      defining: true,\n      parseDOM: [{ tag: 'li' }],\n      toDOM() {\n        return ['li', 0];\n      },\n    },\n\n    text: {\n      group: 'inline',\n    },\n\n    image: {\n      attrs: {\n        src: {},\n        alt: { default: null },\n        title: { default: null },\n      },\n      group: 'block',\n      draggable: true,\n      parseDOM: [\n        {\n          tag: 'p[data-img]',\n          getAttrs(dom) {\n            const image = dom.querySelector('img[src]');\n            return {\n              src: image.getAttribute('src'),\n              title: image.getAttribute('title'),\n              alt: image.getAttribute('alt'),\n            };\n          },\n        },\n      ],\n      toDOM(node) {\n        return ['p', { 'data-img': true }, ['img', node.attrs]];\n      },\n    },\n\n    hard_break: {\n      inline: true,\n      group: 'inline',\n      selectable: false,\n      parseDOM: [{ tag: 'br' }],\n      toDOM() {\n        return ['br'];\n      },\n    },\n  },\n\n  marks: {\n    em: {\n      parseDOM: [\n        { tag: 'i' },\n        { tag: 'em' },\n        { style: 'font-style', getAttrs: value => value == 'italic' && null },\n      ],\n      toDOM() {\n        return ['em'];\n      },\n    },\n\n    strong: {\n      parseDOM: [\n        { tag: 'b' },\n        { tag: 'strong' },\n        {\n          style: 'font-weight',\n          getAttrs: value => /^(bold(er)?|[5-9]\\d{2,})$/.test(value) && null,\n        },\n      ],\n      toDOM() {\n        return ['strong'];\n      },\n    },\n\n    link: {\n      attrs: {\n        href: {},\n        title: { default: null },\n      },\n      inclusive: false,\n      parseDOM: [\n        {\n          tag: 'a[href]',\n          getAttrs(dom) {\n            return {\n              href: dom.getAttribute('href'),\n              title: dom.getAttribute('title'),\n            };\n          },\n        },\n      ],\n      toDOM(node) {\n        return ['a', node.attrs];\n      },\n    },\n\n    code: {\n      parseDOM: [{ tag: 'code' }],\n      toDOM() {\n        return ['code'];\n      },\n    },\n  },\n});\n","import {\n  defaultMarkdownParser as initialDefaultMarkdownParser,\n  defaultMarkdownSerializer as initialDefaultMarkdownSerializer,\n  MarkdownParser,\n} from 'prosemirror-markdown';\n//@ts-ignore\nimport initialSchema from './schema';\nimport { Schema, Mark } from 'prosemirror-model';\nimport { omit, compact } from 'lodash';\nimport markdownit from 'markdown-it/lib';\n\nexport interface MarkdownSchema extends Schema {\n  disabledNodes: string[];\n  disabledMarks: string[];\n}\n\ndeclare module 'prosemirror-markdown' {\n  let schema: MarkdownSchema;\n}\n\nconst IGNORED_NODES = ['horizontal_rule', 'hard_break'];\nconst IGNORED_TOKENS = ['hr', 'hardbreak'];\nconst MARKDOWN_IT_RULES: { [token: string]: string } = {\n  code: 'backticks',\n  heading: 'heading',\n  blockquote: 'blockquote',\n  code_block: 'code',\n  fence: 'fence',\n  bullet_list: 'list',\n  ordered_list: 'list',\n  hr: 'hr',\n  image: 'image',\n  link: 'link',\n};\n\nconst setupSchema = ({\n  disabledMarks = [],\n  disabledNodes = [],\n}: {\n  disabledMarks?: string[];\n  disabledNodes?: string[];\n}) => {\n  if (disabledNodes.includes('code_block')) {\n    disabledNodes.push('fence');\n  }\n\n  initialSchema.nodes = omit(initialSchema.nodes, [\n    ...IGNORED_NODES,\n    ...disabledNodes,\n  ]);\n  initialSchema.marks = omit(initialSchema.marks, disabledMarks);\n\n  initialSchema.disabledNodes = disabledNodes;\n  initialSchema.disabledMarks = disabledMarks;\n\n  return initialSchema;\n};\n\nconst defaultMarkdownParser = (schema: MarkdownSchema) => {\n  const disabledTokens = [\n    ...IGNORED_TOKENS,\n    ...schema.disabledNodes,\n    ...schema.disabledMarks,\n  ];\n  const tokens = omit(initialDefaultMarkdownParser.tokens, disabledTokens);\n\n  const md = markdownit('commonmark', { html: false });\n  const tokensToDisable = compact(\n    disabledTokens.map(t => MARKDOWN_IT_RULES[t])\n  );\n  md.disable(tokensToDisable);\n\n  //@ts-ignore\n  const parser =  new MarkdownParser(schema, md, tokens);\n  parser.tokenHandlers.paragraph_close = (state: any) => {\n    if (state.marks.length) { state.marks = Mark.none; }\n    const info = state.stack.pop();\n    const node = info.type.create(info.attrs, info.content, state.marks);\n    state.push(node);\n    return node;\n  }\n\n  return parser;\n};\n\nconst defaultMarkdownSerializer = (() => {\n  initialDefaultMarkdownSerializer.nodes.code_block = (state, node) => {\n    state.write('~~~' + (node.attrs.params || '') + '\\n');\n    state.text(node.textContent, false);\n    state.ensureNewLine();\n    state.write('~~~');\n    state.closeBlock(node);\n  };\n  return initialDefaultMarkdownSerializer;\n})();\n\nexport { setupSchema, defaultMarkdownParser, defaultMarkdownSerializer };\n","import { Plugin } from 'prosemirror-state';\n\nconst EDITOR_CLASS = 'rich-text-editor';\n\nexport const editorPlugin = (classes: string, placeholder: string) =>\n  new Plugin({\n    props: {\n      attributes: {\n        class: classes.length ? `${EDITOR_CLASS} ${classes}` : EDITOR_CLASS,\n        'data-placeholder': placeholder,\n      },\n    },\n  });\n","import { Plugin } from 'prosemirror-state';\nimport { Slice } from 'prosemirror-model';\nimport { defaultMarkdownParser, MarkdownSchema } from '../markdown';\n\nexport const pastePlugin = (\n  schema: MarkdownSchema,\n  onError: (errors: string) => any\n) =>\n  new Plugin({\n    props: {\n      clipboardTextParser: text => {\n        const fragment = defaultMarkdownParser(schema).parse(text).content;\n        return Slice.maxOpen(fragment);\n      },\n      transformPastedHTML: html => {\n        if (html.includes('<img src')) {\n          onError('Pasted content cannot contain images');\n          return '';\n        }\n\n        return html;\n      },\n    },\n  });\n","import { InputRule } from 'prosemirror-inputrules';\nimport { MarkType } from 'prosemirror-model';\nimport { EditorState } from 'prosemirror-state';\nimport { MarkBetween } from '../../types';\n\nconst getMarksBetween = (start: number, end: number, state: EditorState) => {\n  let marks: MarkBetween[] = [];\n\n  state.doc.nodesBetween(start, end, (node, pos) => {\n    marks = [\n      ...marks,\n      ...node.marks.map(mark => ({\n        start: pos,\n        end: pos + node.nodeSize,\n        mark,\n      })),\n    ];\n  });\n\n  return marks;\n};\n\nexport const markInputRule = function(\n  regexp: RegExp,\n  markType: MarkType,\n  getAttrs?: any\n): InputRule {\n  return new InputRule(regexp, (state, match, start, end) => {\n    const attrs = getAttrs instanceof Function ? getAttrs(match) : getAttrs;\n    const { tr } = state;\n    const m = match.length - 1;\n    let markEnd = end;\n    let markStart = start;\n\n    if (match[m]) {\n      const matchStart = start + match[0].indexOf(match[m - 1]);\n      const matchEnd = matchStart + match[m - 1].length - 1;\n      const textStart = matchStart + match[m - 1].lastIndexOf(match[m]);\n      const textEnd = textStart + match[m].length;\n\n      const excludedMarks = getMarksBetween(start, end, state)\n        .filter(item => item.mark.type.excludes(markType))\n        .filter(item => item.end > matchStart);\n\n      if (excludedMarks.length) {\n        return null;\n      }\n\n      if (textEnd < matchEnd) {\n        tr.delete(textEnd, matchEnd);\n      }\n      if (textStart > matchStart) {\n        tr.delete(matchStart, textStart);\n      }\n      markStart = matchStart;\n      markEnd = markStart + match[m].length;\n    }\n\n    tr.addMark(markStart, markEnd, markType.create(attrs));\n    tr.removeStoredMark(markType);\n    return tr;\n  });\n};\n","import { InputRule } from 'prosemirror-inputrules';\nimport { MarkType } from 'prosemirror-model';\n\nexport const markdownLinkInputRule = function(\n  regexp: RegExp,\n  markType: MarkType\n) {\n  return new InputRule(regexp, (state, match, start, end) => {\n    const tr = state.tr.insertText(match[1], start, end);\n    const mark = markType.create({ href: match[2], title: match[3] });\n    return tr.addMark(start, start + match[1].length, mark);\n  });\n};\n","import { findParentNode, findSelectedNodeOfType } from 'prosemirror-utils';\nimport { EditorState } from 'prosemirror-state';\nimport { NodeType, Node } from 'prosemirror-model';\n\nexport const nodeIsActive = function(\n  state: EditorState,\n  type: NodeType,\n  attrs = {}\n) {\n  const predicate = (node: Node) => node.type === type;\n  const node =\n    findSelectedNodeOfType(type)(state.selection) ||\n    findParentNode(predicate)(state.selection);\n\n  if (!Object.keys(attrs).length || !node) {\n    return {\n      isActive: !!node,\n      node: node?.node,\n    };\n  }\n\n  return {\n    isActive: node.node.hasMarkup(type),\n    node: node.node,\n  };\n};\n","import { setBlockType } from 'prosemirror-commands';\nimport { NodeType } from 'prosemirror-model';\nimport { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { nodeIsActive } from './nodeIsActive';\n\nexport const toggleBlockType = function(\n  type: NodeType,\n  toggletype: NodeType,\n  attrs = {}\n) {\n  return (state: EditorState, dispatch: EditorView['dispatch']) => {\n    const { isActive } = nodeIsActive(state, type, attrs);\n\n    if (isActive) {\n      return setBlockType(toggletype)(state, dispatch);\n    }\n\n    return setBlockType(type, attrs)(state, dispatch);\n  };\n};\n","import { wrapInList, liftListItem } from 'prosemirror-schema-list';\nimport { findParentNode } from 'prosemirror-utils';\nimport { EditorState } from 'prosemirror-state';\nimport { NodeType, Node, Schema } from 'prosemirror-model';\nimport { EditorView } from 'prosemirror-view';\n\nconst isList = (node: Node, schema: Schema) =>\n  node.type === schema.nodes.bullet_list ||\n  node.type === schema.nodes.ordered_list ||\n  node.type === schema.nodes.todo_list;\n\nexport const toggleList = function toggleList(\n  listType: NodeType,\n  itemType: NodeType\n) {\n  return (state: EditorState, dispatch: EditorView['dispatch']) => {\n    const { schema, selection } = state;\n    const { $from, $to } = selection;\n    const range = $from.blockRange($to);\n\n    if (!range) {\n      return false;\n    }\n\n    const parentList = findParentNode(node => isList(node, schema))(selection);\n\n    if (range.depth >= 1 && parentList && range.depth - parentList.depth <= 1) {\n      if (parentList.node.type === listType) {\n        return liftListItem(itemType)(state, dispatch);\n      }\n\n      if (\n        isList(parentList.node, schema) &&\n        listType.validContent(parentList.node.content)\n      ) {\n        const { tr } = state;\n        tr.setNodeMarkup(parentList.pos, listType);\n\n        if (dispatch) {\n          dispatch(tr);\n        }\n\n        return false;\n      }\n    }\n\n    return wrapInList(listType)(state, dispatch);\n  };\n};\n","import { MenuItem } from '../../types';\nimport { MarkType, NodeType } from 'prosemirror-model';\nimport { EditorView } from 'prosemirror-view';\nimport { Plugin } from 'prosemirror-state';\nimport { nodeIsActive, markIsActive } from '../utils';\n\nclass Menu {\n  items: MenuItem[];\n  editorView: EditorView;\n  onUpdate: (items: string[]) => any;\n\n  constructor(\n    items: MenuItem[],\n    editorView: EditorView,\n    onUpdate: (items: string[]) => any\n  ) {\n    this.items = items;\n    this.editorView = editorView;\n    this.onUpdate = onUpdate;\n  }\n\n  markActive(type: MarkType | NodeType): boolean {\n    const { state } = this.editorView;\n\n    if (type instanceof NodeType) {\n      return nodeIsActive(state, type).isActive;\n    }\n\n    return markIsActive(state, type);\n  }\n\n  update() {\n    const activeItems = this.items.filter(item => this.markActive(item.type));\n    if (activeItems.length) {\n      this.onUpdate(activeItems.map(i => i.name));\n    } else {\n      this.onUpdate([]);\n    }\n  }\n\n  destroy() {\n    this.onUpdate([]);\n  }\n}\n\nexport const menuPlugin = (\n  items: MenuItem[],\n  onUpdate: (items: string[]) => any\n) =>\n  new Plugin({\n    view: editorView => new Menu(items, editorView, onUpdate),\n  });\n","import { EditorState } from 'prosemirror-state';\nimport { MarkType } from 'prosemirror-model';\n\nexport const markIsActive = function(state: EditorState, type: MarkType) {\n  const { from, $from, to, empty } = state.selection;\n\n  if (empty) {\n    return !!type.isInSet(state.storedMarks || $from.marks());\n  }\n\n  return !!state.doc.rangeHasMark(from, to, type);\n};\n","import { Plugin } from 'prosemirror-state';\nimport { Decoration, DecorationSet } from 'prosemirror-view';\nimport { EditorState } from 'prosemirror-state';\n\nexport const placeholderPlugin = new Plugin({\n  state: {\n    init() {\n      return DecorationSet.empty;\n    },\n    apply(this: Plugin, tr, set: DecorationSet) {\n      // Adjust decoration positions to changes made by the transaction\n      set = set.map(tr.mapping, tr.doc);\n      // See if the transaction adds or removes any placeholders\n      let action = tr.getMeta(this);\n      if (action && action.add) {\n        let widget = document.createElement('div');\n        widget.className = 'image__placeholder';\n        let loader = document.createElement('div');\n        loader.className = 'loader';\n        widget.appendChild(loader);\n        let deco = Decoration.widget(action.add.pos, widget, {\n          id: action.add.id,\n        });\n        set = set.add(tr.doc, [deco]);\n      } else if (action && action.remove) {\n        set = set.remove(\n          set.find(undefined, undefined, spec => spec.id === action.remove.id)\n        );\n      }\n      return set;\n    },\n  },\n  props: {\n    decorations(this: Plugin, state) {\n      return this.getState(state);\n    },\n  },\n});\n\nexport const findPlaceholder = function(state: EditorState, id: {}) {\n  let decos = placeholderPlugin.getState(state);\n  let found = decos.find(undefined, undefined, spec => spec.id === id);\n  return found.length ? found[0].from : null;\n};\n","import { placeholderPlugin, findPlaceholder } from './placeholder';\nimport { EditorView } from 'prosemirror-view';\n\nexport const fileUpload = (\n  view: EditorView,\n  images: File[],\n  endpoint: { url: string; csrfToken: string },\n  position: number,\n  onError: (errors: string) => any\n): boolean => {\n  let id = {};\n  const confirmResult = window.confirm('I am authorised to use this content');\n  if (!confirmResult) {\n    return false;\n  }\n\n  const tr = view.state.tr;\n  tr.setMeta(placeholderPlugin, { add: { id, pos: position } });\n  tr.setSelection(tr.selection);\n  view.dispatch(tr);\n  const { schema } = view.state;\n\n  images.forEach(image => {\n    const pos = findPlaceholder(view.state, id);\n    if (!pos) return;\n    const formData = new FormData();\n    formData.append('image', image);\n    const xhr = new XMLHttpRequest();\n    xhr.withCredentials = true;\n    xhr.open('POST', endpoint.url, true);\n    xhr.setRequestHeader('X-CSRF-TOKEN', endpoint.csrfToken);\n    xhr.onerror = () => {\n      const transaction = view.state.tr.setMeta(placeholderPlugin, {\n        remove: { id },\n      });\n      onError('Sorry something went wrong');\n      view.dispatch(transaction);\n    };\n\n    xhr.onload = () => {\n      let transaction;\n      let jsonBody;\n      try {\n        jsonBody = JSON.parse(xhr.response);\n      } catch {\n        jsonBody = { errors: 'Sorry something went wrong' };\n      }\n      if ([200, 201].includes(xhr.status)) {\n        const node = schema.nodes.image.create({\n          src: jsonBody.data.url,\n        });\n\n        transaction = view.state.tr\n          .replaceWith(pos, pos, node)\n          .setMeta(placeholderPlugin, { remove: { id } });\n      } else {\n        transaction = view.state.tr.setMeta(placeholderPlugin, {\n          remove: { id },\n        });\n        onError(jsonBody.errors);\n      }\n      view.dispatch(transaction);\n    };\n    xhr.send(formData);\n  });\n\n  return true;\n};\n","import { Decoration, DecorationSet } from 'prosemirror-view';\nimport { Node } from 'prosemirror-model';\nimport { Language } from '../../types';\nimport low from 'lowlight/lib/core';\nimport { Plugin, PluginKey } from 'prosemirror-state';\nimport { findBlockNodes } from 'prosemirror-utils';\nimport { flattenDeep } from 'lodash';\n\n//@ts-ignore\nimport javascript from 'highlight.js/lib/languages/javascript';\n//@ts-ignore\nimport python from 'highlight.js/lib/languages/python';\n//@ts-ignore\nimport r from 'highlight.js/lib/languages/r';\n//@ts-ignore\nimport css from 'highlight.js/lib/languages/css';\n//@ts-ignore\nimport java from 'highlight.js/lib/languages/java';\n\nfunction getDecorations({ doc, name }: { doc: Node; name: string }) {\n  const decorations: Decoration[] = [];\n  const languages: Language[] = [];\n  const blocks = findBlockNodes(doc).filter(\n    item => item.node.type.name === name\n  );\n\n  function parseNodes(nodes: lowlight.HastNode[], className = []) {\n    return nodes.map(node => {\n      const classes = [\n        ...className,\n        //@ts-ignore\n        ...(node.properties ? node.properties.className : []),\n      ];\n\n      //@ts-ignore\n      if (node.children) {\n        //@ts-ignore\n        return parseNodes(node.children, classes);\n      }\n\n      return {\n        //@ts-ignore\n        text: node.value,\n        classes,\n      };\n    });\n  }\n\n  blocks.forEach(block => {\n    let startPos = block.pos + 1;\n    const { value: nodes, language, relevance } = low.highlightAuto(\n      block.node.textContent\n    );\n\n    if (relevance > 1) {\n      if (language && language !== block.node.attrs.params) {\n        languages.push({ language, pos: block.pos, type: block.node.type });\n      }\n\n      flattenDeep(parseNodes(nodes))\n        .map(node => {\n          const from = startPos;\n          const to = from + node.text.length;\n\n          startPos = to;\n\n          return {\n            ...node,\n            from,\n            to,\n          };\n        })\n        .forEach(node => {\n          const decoration = Decoration.inline(node.from, node.to, {\n            class: node.classes.join(' '),\n          });\n          decorations.push(decoration);\n        });\n    }\n  });\n\n  return { decorations: DecorationSet.create(doc, decorations), languages };\n}\n\nexport const highlightPlugin = ({ name }: { name: string }) => {\n  low.registerLanguage('javascript', javascript);\n  low.registerLanguage('python', python);\n  low.registerLanguage('r', r);\n  low.registerLanguage('css', css);\n  low.registerLanguage('java', java);\n  const key = new PluginKey('highlight');\n  return new Plugin({\n    key,\n    state: {\n      init: (_, { doc }) => getDecorations({ doc, name }),\n      apply: (transaction, decorationSet, oldState, state) => {\n        const nodeName = state.selection.$head.parent.type.name;\n        const previousNodeName = oldState.selection.$head.parent.type.name;\n\n        if (\n          transaction.docChanged &&\n          [nodeName, previousNodeName].includes(name)\n        ) {\n          return getDecorations({ doc: transaction.doc, name });\n        }\n\n        const decorations = decorationSet.decorations || decorationSet;\n        return decorations.map(transaction.mapping, transaction.doc);\n      },\n    },\n    props: {\n      decorations(this: Plugin, state) {\n        const decorationSet = this.getState(state);\n        return decorationSet.decorations || decorationSet;\n      },\n    },\n    view: _view => {\n      return {\n        update: (view, prevState) => {\n          const highlight = key.get(prevState);\n          if (highlight) {\n            const { languages } = highlight.getState(prevState) as {\n              languages: Language[];\n            };\n            if (languages && languages.length) {\n              languages.forEach(lang => {\n                const transaction = view.state.tr.setNodeMarkup(\n                  lang.pos,\n                  lang.type,\n                  { params: lang.language }\n                );\n                view.dispatch(transaction);\n              });\n            }\n          }\n        },\n      };\n    },\n  });\n};\n","import { Schema, MarkType, NodeType } from 'prosemirror-model';\nimport { keymap } from 'prosemirror-keymap';\nimport { inputRules, InputRule } from 'prosemirror-inputrules';\n\nclass BaseType {\n  schema: Schema;\n  constructor(schema: Schema) {\n    this.schema = schema;\n  }\n\n  get name() {\n    return '';\n  }\n\n  get icon() {\n    return '';\n  }\n\n  get inToolbar() {\n    return true;\n  }\n\n  get command() {\n    return (_state: any, _dispatch: any) => {};\n  }\n\n  get shortcuts() {\n    return {};\n  }\n\n  get rules() {\n    return [] as InputRule[];\n  }\n\n  get type(): MarkType | NodeType | null {\n    return this._type;\n  }\n\n  protected get _type(): MarkType | NodeType | null {\n    return null;\n  }\n\n  getPlugins() {\n    if (this._type) {\n      return [keymap(this.shortcuts), inputRules({ rules: this.rules })];\n    }\n\n    return [];\n  }\n\n  getToolbarItem() {\n    if (this._type && this.inToolbar && this.command) {\n      return {\n        name: this.name,\n        icon: this.icon,\n        command: this.command,\n        type: this.type,\n      };\n    }\n\n    return null;\n  }\n}\n\nexport default BaseType;\n","import { MarkType } from 'prosemirror-model';\nimport BaseType from '../BaseType';\n\nclass Mark extends BaseType {\n  get type(): MarkType {\n    return this._type as MarkType;\n  }\n\n  protected get _type() {\n    return this.schema.marks[this.name];\n  }\n}\n\nexport default Mark;\n","import { linkInputRule, markdownLinkInputRule } from '../utils';\nimport Mark from './Mark';\n\nconst URL_REGEX = /(https?:\\/\\/(www\\.)?[-a-zA-Z0-9@:%._\\\\+~#=]{2,256}\\.[a-z]{2,6}\\b([-a-zA-Z0-9@:%_\\\\+.~#?&//=]*))\\s$/g;\nconst MARKDOWN_URL_REGX = /\\[(.+)\\]\\((https?[^ ]+)(?: \"(.+)\")?\\)$/;\n\nclass Link extends Mark {\n  get name() {\n    return 'link';\n  }\n\n  get rules() {\n    return [\n      linkInputRule(URL_REGEX, this.type),\n      markdownLinkInputRule(MARKDOWN_URL_REGX, this.type),\n    ];\n  }\n\n  get inToolbar() {\n    return false;\n  }\n}\n\nexport default Link;\n","import Strong from './Strong';\nimport Emphasis from './Emphasis';\nimport InlineCode from './InlineCode';\nimport Link from './Link';\nimport { flatMap, compact } from 'lodash';\nimport { Schema } from 'prosemirror-model';\n\nconst MARKS = [Strong, Emphasis, InlineCode, Link];\n\nexport const plugins = (schema: Schema) => {\n  return flatMap(MARKS, Mark => new Mark(schema).getPlugins());\n};\n\nexport const toolbarItems = (schema: Schema) => {\n  return compact(MARKS.map(Mark => new Mark(schema).getToolbarItem()));\n};\n","import { toggleMark } from 'prosemirror-commands';\nimport { markInputRule } from '../utils';\nimport Mark from './Mark';\n\nclass Strong extends Mark {\n  get name() {\n    return 'strong';\n  }\n\n  get icon() {\n    return 'Bold';\n  }\n\n  get command() {\n    return toggleMark(this.type);\n  }\n\n  get shortcuts() {\n    return {\n      'Mod-b': toggleMark(this.type),\n      'Mod-B': toggleMark(this.type),\n    };\n  }\n\n  get rules() {\n    return [markInputRule(/(?:\\*\\*|__)([^*_]+)(?:\\*\\*|__)$/, this.type)];\n  }\n}\n\nexport default Strong;\n","import { toggleMark } from 'prosemirror-commands';\nimport { markInputRule } from '../utils';\nimport Mark from './Mark';\n\nclass Emphasis extends Mark {\n  get name() {\n    return 'em';\n  }\n\n  get icon() {\n    return 'Italic';\n  }\n\n  get shortcuts() {\n    return {\n      'Mod-i': toggleMark(this.type),\n      'Mod-I': toggleMark(this.type),\n    };\n  }\n\n  get rules() {\n    return [\n      markInputRule(/(?:^|[^_])(_([^_]+)_)$/, this.type),\n      markInputRule(/(?:^|[^*])(\\*([^*]+)\\*)$/, this.type),\n    ];\n  }\n\n  get command() {\n    return toggleMark(this.type);\n  }\n}\n\nexport default Emphasis;\n","import { toggleMark } from 'prosemirror-commands';\nimport { markInputRule } from '../utils';\nimport Mark from './Mark';\n\nclass InlineCode extends Mark {\n  get name() {\n    return 'code';\n  }\n\n  get icon() {\n    return 'Code';\n  }\n\n  get shortcuts() {\n    return {\n      'Mod-`': toggleMark(this.type),\n    };\n  }\n\n  get rules() {\n    return [markInputRule(/(?:`)([^`]+)(?:`)$/, this.type)];\n  }\n\n  get command() {\n    return toggleMark(this.type);\n  }\n}\n\nexport default InlineCode;\n","import { InputRule } from 'prosemirror-inputrules';\nimport { MarkType } from 'prosemirror-model';\n\nexport const linkInputRule = function(regexp: RegExp, markType: MarkType) {\n  return new InputRule(regexp, (state, match, start, end) => {\n    const tr = state.tr.insertText(match[0], start, end);\n    const mark = markType.create({ href: match[1] });\n    return tr.addMark(start, start + match[1].length, mark);\n  });\n};\n","import { NodeType } from 'prosemirror-model';\nimport BaseType from '../BaseType';\n\nclass Node extends BaseType {\n  get type(): NodeType {\n    return this._type as NodeType;\n  }\n\n  protected get _type() {\n    return this.schema.nodes[this.name];\n  }\n\n  get paragraphType() {\n    return this.schema.nodes.paragraph;\n  }\n\n  get listItemType() {\n    return this.schema.nodes.list_item;\n  }\n}\n\nexport default Node;\n","import { textblockTypeInputRule } from 'prosemirror-inputrules';\nimport { toggleBlockType } from '../utils';\nimport Node from './Node';\n\nconst LEVELS = [1, 2, 3, 4, 5, 6];\n\nclass Heading extends Node {\n  get name() {\n    return 'heading';\n  }\n\n  get icon() {\n    return 'Heading';\n  }\n\n  get command() {\n    return toggleBlockType(this.type, this.paragraphType, this.schema);\n  }\n\n  get rules() {\n    return LEVELS.map(l =>\n      textblockTypeInputRule(new RegExp(`^(#{1,${l}})\\\\s$`), this.type, () => ({\n        level: l,\n      }))\n    );\n  }\n}\n\nexport default Heading;\n","import Blockquote from './Blockquote';\nimport Heading from './Heading';\nimport BulletList from './BulletList';\nimport OrderedList from './OrderedList';\nimport CodeBlock from './CodeBlock';\nimport { flatMap, compact } from 'lodash';\nimport { Schema } from 'prosemirror-model';\n\nconst NODES = [Blockquote, Heading, BulletList, OrderedList, CodeBlock];\n\nexport const plugins = (schema: Schema) => {\n  return flatMap(NODES, Node => new Node(schema).getPlugins());\n};\n\nexport const toolbarItems = (schema: Schema) => {\n  return compact(NODES.map(Node => new Node(schema).getToolbarItem()));\n};\n","import { wrappingInputRule } from 'prosemirror-inputrules';\nimport { toggleWrap } from '../utils';\nimport Node from './Node';\n\nclass Blockquote extends Node {\n  get name() {\n    return 'blockquote';\n  }\n\n  get icon() {\n    return 'Quote';\n  }\n\n  get command() {\n    return toggleWrap(this.type);\n  }\n\n  get rules() {\n    return [wrappingInputRule(/^\\s*>\\s$/, this.type)];\n  }\n}\n\nexport default Blockquote;\n","import { wrapIn, lift } from 'prosemirror-commands';\nimport { NodeType } from 'prosemirror-model';\nimport { nodeIsActive } from './nodeIsActive';\nimport { EditorState } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\n\nexport const toggleWrap = function(type: NodeType) {\n  return (state: EditorState, dispatch: EditorView['dispatch']) => {\n    const { isActive } = nodeIsActive(state, type);\n\n    if (isActive) {\n      return lift(state, dispatch);\n    }\n\n    return wrapIn(type)(state, dispatch);\n  };\n};\n","import { wrappingInputRule } from 'prosemirror-inputrules';\nimport { toggleList } from '../utils';\nimport Node from './Node';\n\nclass BulletList extends Node {\n  get name() {\n    return 'bullet_list';\n  }\n\n  get icon() {\n    return 'UnorderedList';\n  }\n\n  get command() {\n    return toggleList(this.type, this.listItemType);\n  }\n\n  get rules() {\n    return [wrappingInputRule(/^\\s*([-+*])\\s$/, this.type)];\n  }\n}\n\nexport default BulletList;\n","import { wrappingInputRule } from 'prosemirror-inputrules';\nimport { toggleList } from '../utils';\nimport Node from './Node';\n\nclass OrderedList extends Node {\n  get name() {\n    return 'ordered_list';\n  }\n\n  get icon() {\n    return 'OrderedList';\n  }\n\n  get command() {\n    return toggleList(this.type, this.listItemType);\n  }\n\n  get rules() {\n    return [\n      wrappingInputRule(\n        /^(\\d+)\\.\\s$/,\n        this.type,\n        match => ({ order: +match[1] }),\n        (match, node) => node.childCount + node.attrs.order === +match[1]\n      ),\n    ];\n  }\n}\n\nexport default OrderedList;\n","import { textblockTypeInputRule } from 'prosemirror-inputrules';\nimport { toggleBlockType } from '../utils';\nimport Node from './Node';\n\nclass CodeBlock extends Node {\n  get name() {\n    return 'code_block';\n  }\n\n  get icon() {\n    return 'CodeBlock';\n  }\n\n  get command() {\n    return toggleBlockType(this.type, this.paragraphType, this.schema);\n  }\n\n  get rules() {\n    return [textblockTypeInputRule(/^(```|~~~)$/, this.type)];\n  }\n}\n\nexport default CodeBlock;\n","import { MenuItem } from '../types';\nimport { toolbarItems as markToolbarItems } from '../Editor/Marks';\nimport { toolbarItems as nodeToolbarItems } from '../Editor/Nodes';\nimport { Schema } from 'prosemirror-model';\n\nconst menuItems = (schema: Schema) =>\n  [...markToolbarItems(schema), ...nodeToolbarItems(schema)] as MenuItem[];\n\nexport default menuItems;\n","import { Icons as IconsType } from '../types';\nimport Bold from './Bold';\nimport Code from './Code';\nimport CodeBlock from './CodeBlock';\nimport Heading from './Heading';\nimport Image from './Image';\nimport Italic from './Italic';\nimport OrderedList from './OrderedList';\nimport Quote from './Quote';\nimport UnorderedList from './UnorderedList';\n\nconst Icons: IconsType = {\n  Bold,\n  Code,\n  CodeBlock,\n  Heading,\n  Image,\n  Italic,\n  OrderedList,\n  Quote,\n  UnorderedList,\n};\n\nexport default Icons;\n","import React from 'react';\n\nconst Bold = () => (\n  <svg className=\"a-svg-icon a-svg-icon--bold\" viewBox=\"0 0 32 32\">\n    <path\n      d=\"M24.2,17.4c-0.9-0.9-2-1.7-3.3-2.1c1.8-1,3.6-3,3.6-6.7c0-0.1,0.2-3.5-2.1-5.9C20.8,0.9,18.5,0,15.5,0H9v0H7\n  v32h0.8v0H16c0.1,0,0.1,0,0.2,0c1.5,0,5.3-0.1,7.8-2.6c1.5-1.5,2.3-3.6,2.3-6.1C26.3,22.8,26.4,19.8,24.2,17.4z M15.5,2\n  c2.4,0,4.2,0.6,5.4,1.9c1.7,1.8,1.6,4.4,1.6,4.5c0,2.6-1,4.3-3,5.3c-1.1,0.5-2.4,0.8-4,0.8H9V2H15.5z M24.2,23.1l0,0.1\n  c0,2-0.6,3.6-1.7,4.8c-2,2-5.5,2-6.6,2H9V16.5h6.8c3.2-0.1,5.5,0.7,6.9,2.2C24.4,20.6,24.2,23.1,24.2,23.1z\"\n    />\n  </svg>\n);\n\nexport default Bold;\n","import React from 'react';\n\nconst Code = () => (\n  <svg className=\"a-svg-icon a-svg-icon--code\" viewBox=\"0 0 32 32\">\n    <polygon points=\"13.1,6.7 11.6,5.3 1,16 11.7,26.7 13.1,25.3 3.8,16 \" />\n    <polygon points=\"20.4,5.3 19,6.7 28.2,16 19,25.3 20.4,26.7 31,16 \" />\n  </svg>\n);\n\nexport default Code;\n","import React from 'react';\n\nconst CodeBlock = () => (\n  <svg viewBox=\"0 0 32 32\">\n    <path\n      fill=\"#3A343A\"\n      d=\"M11.97,1.02L10.69,1v0C10.47,1,8.7,0.85,7.48,1.96c-0.6,0.55-0.92,1.31-0.92,2.2v9.66  c0,0.42-0.15,0.6-0.27,0.72C5.77,15.06,3.97,15,3.97,15v2c0,0,1.79-0.07,2.33,0.46c0.12,0.12,0.27,0.3,0.27,0.72v9.66  c0,0.89,0.32,1.65,0.92,2.2C8.7,31.15,10.47,31,10.69,31v0l1.28-0.02V29L10.69,29c-0.33,0.02-1.38,0-1.86-0.44  c-0.12-0.11-0.27-0.3-0.27-0.72v-9.66c0-0.87-0.31-1.63-0.9-2.18c0.58-0.55,0.9-1.31,0.9-2.18V4.16c0-0.42,0.14-0.61,0.27-0.72  C9.31,2.99,10.36,2.97,10.69,3v0L11.97,3V1.02z\"\n    />\n    <path\n      fill=\"#3A343A\"\n      d=\"M19.98,1.02L21.26,1v0c0.22,0,1.99-0.15,3.21,0.97c0.6,0.55,0.92,1.31,0.92,2.2v9.66  c0,0.42,0.15,0.6,0.27,0.72c0.52,0.52,2.33,0.46,2.33,0.46v2c0,0-1.79-0.07-2.33,0.46c-0.12,0.12-0.27,0.3-0.27,0.72v9.66  c0,0.89-0.32,1.65-0.92,2.2C23.25,31.15,21.49,31,21.26,31v0l-1.28-0.02V29L21.26,29c0.33,0.02,1.38,0,1.86-0.44  c0.12-0.11,0.27-0.3,0.27-0.72v-9.66c0-0.87,0.31-1.63,0.9-2.18c-0.58-0.55-0.9-1.31-0.9-2.18V4.16c0-0.42-0.14-0.61-0.27-0.72  C22.64,2.99,21.59,2.97,21.26,3v0L19.98,3V1.02z\"\n    />\n  </svg>\n);\n\nexport default CodeBlock;\n","import React from 'react';\n\nconst Heading = () => (\n  <svg className=\"a-svg-icon a-svg-icon--heading\" viewBox=\"0 0 32 32\">\n    <polygon points=\"25,0 25,15 7,15 7,0 5,0 5,32 7,32 7,17 25,17 25,32 27,32 27,0 \" />\n  </svg>\n);\n\nexport default Heading;\n","import React from 'react';\n\nconst Image = () => (\n  <svg className=\"a-svg-icon a-svg-icon--italic\" viewBox=\"0 0 32 32\">\n    <circle cx=\"21.5\" cy=\"11.5\" r=\"4.5\" />\n    <polygon points=\"32,6 32,0 0,0 0,32 32,32 32,11 30,11 30,30 16,20 2,30 2,2 30,2 30,6\" />\n  </svg>\n);\n\nexport default Image;\n","import React from 'react';\n\nconst Italic = () => (\n  <svg className=\"a-svg-icon a-svg-icon--italic\" viewBox=\"0 0 32 32\">\n    <polygon points=\"25.3,2 25.3,0 13.3,0 13.3,2 18.1,2 12.2,30 7,30 7,32 19,32 19,30 14.2,30 20.1,2 \" />\n  </svg>\n);\n\nexport default Italic;\n","import React from 'react';\n\nconst OrderedList = () => (\n  <svg className=\"a-svg-icon a-svg-icon--ordered-list\" viewBox=\"0 0 32 32\">\n    <rect x=\"10\" y=\"3\" width=\"22\" height=\"2\" />\n    <rect x=\"10\" y=\"15\" width=\"22\" height=\"2\" />\n    <rect x=\"10\" y=\"27\" width=\"22\" height=\"2\" />\n    <path\n      d=\"M3.8,25.1c-1,0-1.3,0.8-1.3,0.8l-1.3-0.7c0,0,0.7-1.6,2.7-1.6c1.5,0,2.9,0.8,2.9,2.4c0,1.1-0.9,1.4-0.9,1.4\n    s1,0.4,1,1.7c0,1.6-1.4,2.4-2.9,2.4c-2.2,0-2.8-1.8-2.8-1.8l1.4-0.8c0,0,0.3,1.1,1.4,1.1c0.7,0,1-0.4,1-0.9c0-0.6-0.5-0.9-1.3-0.9\n    H3.3v-1.3h0.3c0.6,0,1.3-0.2,1.3-0.9C4.9,25.5,4.5,25.1,3.8,25.1z\"\n    />\n    <path\n      d=\"M4.1,16C4.4,15.6,5,15,5,14.3c0-0.6-0.5-1.1-1.2-1.1c-1,0-1.3,1.1-1.3,1.1L1,13.8c0,0,0.6-2.3,2.8-2.3\n    c2,0,3,1.4,3,2.7c0,0.8-0.4,1.5-0.6,1.7L4.7,18h2.2v1.6H1.1L4.1,16z\"\n    />\n    <path d=\"M4.4,0.6H6v7.9H4.2V2.9L2.4,4.5l-1-1.3L4.4,0.6z\" />\n  </svg>\n);\n\nexport default OrderedList;\n","import React from 'react';\n\nconst Quote = () => (\n  <svg className=\"a-svg-icon a-svg-icon--quote\" viewBox=\"0 0 32 32\">\n    <path d=\"M11.1,26V15.9H5.6C6,12.3,8.3,9.5,12,9.5V5.8c-5.8,0-10.5,4.4-11,10.1l0,0V26H11.1z\" />\n    <path d=\"M20.9,5.8v10.1h5.5c-0.5,3.6-2.7,6.4-6.4,6.4V26c5.8,0,10.5-4.4,11-10.1l0,0V5.8L20.9,5.8z\" />\n  </svg>\n);\n\nexport default Quote;\n","import React from 'react';\n\nconst UnorderedList = () => (\n  <svg className=\"a-svg-icon a-svg-icon--unordered-list\" viewBox=\"0 0 32 32\">\n    <circle cx=\"2.5\" cy=\"4\" r=\"2.5\" />\n    <circle cx=\"2.5\" cy=\"16\" r=\"2.5\" />\n    <circle cx=\"2.5\" cy=\"28\" r=\"2.5\" />\n    <rect x=\"8\" y=\"3\" width=\"24\" height=\"2\" />\n    <rect x=\"8\" y=\"15\" width=\"24\" height=\"2\" />\n    <rect x=\"8\" y=\"27\" width=\"24\" height=\"2\" />\n  </svg>\n);\n\nexport default UnorderedList;\n","import React, { FunctionComponent } from 'react';\nimport { ToolbarItem } from '../types';\nimport classNames from 'classnames';\nimport Icons from '../Icons';\n\nconst Item: FunctionComponent<ToolbarItem> = ({\n  item,\n  item: { icon, name },\n  isActive,\n  onClick,\n}) => {\n  const Icon = Icons[icon];\n  return (\n    <button\n      className={classNames('item', { 'item--active': isActive })}\n      data-item={name}\n      onClick={() => onClick(item)}\n      type=\"button\"\n    >\n      <Icon />\n    </button>\n  );\n};\n\nexport default Item;\n","import React, { ChangeEvent } from 'react';\nimport { fileUpload } from '../Editor/Plugins/fileUpload';\nimport Icons from '../Icons';\n\nconst ImageUpload = ({\n  editor,\n  imageUploadEndpoint,\n  onError,\n}: {\n  editor: any;\n  imageUploadEndpoint: any;\n  onError: any;\n}) => {\n  const onImageUpload = (e: ChangeEvent) => {\n    if (!imageUploadEndpoint) return;\n    if (!editor) return;\n    if (!e.target) return;\n    const target = e.target as HTMLInputElement;\n    if (!target.files) return;\n\n    e.preventDefault();\n\n    fileUpload(\n      editor,\n      Array.from(target.files),\n      imageUploadEndpoint,\n      editor.state.tr.selection.from,\n      onError\n    );\n    editor.focus();\n    target.value = '';\n  };\n\n  return (\n    <div className=\"fileUploadWrapper\">\n      <input\n        type=\"file\"\n        accept=\".jpg,.jpeg,.png,.gif\"\n        onChange={onImageUpload}\n      />\n      <button data-item=\"image\" className=\"item fileUploadWrapper--button\">\n        <Icons.Image />\n      </button>\n    </div>\n  );\n};\n\nexport default ImageUpload;\n","import React, { useMemo } from 'react';\nimport Item from './Item';\nimport { FunctionComponent } from 'react';\nimport menuItems from './menuItems';\nimport { Toolbar as ToolbarType } from '../types';\nimport ImageUpload from './ImageUpload';\n\nconst Toolbar: FunctionComponent<ToolbarType> = ({\n  onClick,\n  activeOptions,\n  editor,\n  imageUploadEndpoint,\n  disabledItems = [],\n  onError,\n}) => {\n  const menuItemsToRender = useMemo(() => {\n    return menuItems(editor.state.schema).filter(\n      i => !disabledItems.includes(i.name)\n    );\n  }, [disabledItems, editor.state.schema]);\n\n  return (\n    <div className=\"toolbar\">\n      {menuItemsToRender.map(item => (\n        <Item\n          key={item.name}\n          item={item}\n          onClick={onClick}\n          isActive={activeOptions.includes(item.name)}\n        />\n      ))}\n\n      {!disabledItems.includes('image') && (\n        <ImageUpload\n          editor={editor}\n          imageUploadEndpoint={imageUploadEndpoint}\n          onError={onError}\n        />\n      )}\n    </div>\n  );\n};\n\nexport default React.memo(Toolbar);\n","import React, { FunctionComponent } from 'react';\nimport { ContextualHelp as ContextualHelpType } from '../types';\n\nconst ContextualHelp: FunctionComponent<ContextualHelpType> = ({\n  activeOptions,\n}) => {\n  const helpText: { [key: string]: string } = {\n    code_block: 'Hold down shift and press enter to exit the code block',\n  };\n\n  return <p>{activeOptions.map(o => helpText[o])}</p>;\n};\n\nexport default ContextualHelp;\n","import React, {\n  FunctionComponent,\n  useEffect,\n  useRef,\n  useState,\n  useCallback,\n} from 'react';\nimport { MarkDownEditor as MarkDownEditorType, MenuItem } from './types';\nimport { createEditorView } from './Editor';\nimport { EditorView } from 'prosemirror-view';\nimport Toolbar from './Toolbar';\nimport './index.scss';\nimport classNames from 'classnames';\nimport ContextualHelp from './ContextualHelp';\n\nconst MarkDownEditor: FunctionComponent<MarkDownEditorType> = ({\n  id,\n  name,\n  onChange = () => {},\n  value = '',\n  placeholder = 'Enter text',\n  classes = '',\n  imageUploadEndpoint,\n  onError = () => {},\n  disabledMarks = [],\n  disabledNodes = [],\n  inputRef,\n}) => {\n  const editorRef = useRef<HTMLDivElement>(null);\n  const [editor, setEditor] = useState<EditorView | null>(null);\n  const [markdownValue, setMarkdownValue] = useState<string>(value);\n  const [activeOptions, setActiveOptions] = useState<string[]>([]);\n  const disabledItems = useRef([...disabledMarks, ...disabledNodes]);\n  const activeOptionsRef = useRef(activeOptions);\n\n  const onInputChange = (md: string) => {\n    setMarkdownValue(md);\n    onChange(md);\n  };\n\n  const onToolbarChange = (options: string[]) => {\n    if (JSON.stringify(options) !== JSON.stringify(activeOptionsRef.current)) {\n      setActiveOptions(options);\n    }\n  };\n\n  const initEditor = () => {\n    if (editorRef.current) {\n      const editorView = createEditorView({\n        node: editorRef.current,\n        value,\n        onChange: onInputChange,\n        classes,\n        placeholder,\n        onToolbarChange: onToolbarChange,\n        imageUploadEndpoint,\n        onError: onError,\n        disabledNodes,\n        disabledMarks,\n      });\n\n      setEditor(editorView);\n    }\n  };\n\n  const onToolbarClick = useCallback(\n    ({ command }: MenuItem) => {\n      if (editor) {\n        editor.focus();\n        command(editor.state, editor.dispatch, editor);\n      }\n    },\n    [editor]\n  );\n\n  useEffect(() => {\n    activeOptionsRef.current = activeOptions;\n  }, [activeOptions]);\n\n  useEffect(() => {\n    if (inputRef) {\n      inputRef.current = editor;\n    }\n  }, [editor]);\n\n  useEffect(() => {\n    if (value !== markdownValue && editor) {\n      editor.destroy();\n      initEditor();\n    }\n  }, [value]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    initEditor();\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\n\n  return (\n    <>\n      {editor && (\n        <Toolbar\n          activeOptions={activeOptions}\n          onClick={onToolbarClick}\n          editor={editor}\n          disabledItems={disabledItems.current}\n          imageUploadEndpoint={imageUploadEndpoint}\n          onError={onError}\n        />\n      )}\n      <div\n        id={id}\n        className={classNames({ hasPlaceholder: !markdownValue.length })}\n        ref={editorRef}\n      />\n      <ContextualHelp activeOptions={activeOptions} />\n      <input\n        type=\"hidden\"\n        value={markdownValue}\n        onChange={() => {}}\n        name={name}\n      />\n    </>\n  );\n};\n\nexport default MarkDownEditor;\n","import { CreateEditorViewOptions } from '../types';\nimport { EditorView } from 'prosemirror-view';\nimport { EditorState, Transaction } from 'prosemirror-state';\nimport {\n  defaultMarkdownParser,\n  defaultMarkdownSerializer,\n  setupSchema,\n} from './markdown';\nimport { keymap } from 'prosemirror-keymap';\nimport { baseKeymap, exitCode, setBlockType } from 'prosemirror-commands';\nimport { history, undo, redo } from 'prosemirror-history';\nimport { splitListItem } from 'prosemirror-schema-list';\nimport {\n  editorPlugin,\n  pastePlugin,\n  menuPlugin,\n  imageDropPlugin,\n  placeholderPlugin,\n  highlightPlugin,\n} from './Plugins';\nimport toolbarItems from '../Toolbar/menuItems';\nimport { plugins as markPlugins } from './Marks';\nimport { plugins as nodePlugins } from './Nodes';\n\nconst createEditorView = ({\n  node,\n  value,\n  onChange,\n  classes,\n  placeholder,\n  onToolbarChange,\n  imageUploadEndpoint,\n  disabledMarks,\n  disabledNodes,\n  onError,\n}: CreateEditorViewOptions): EditorView => {\n  const schema = setupSchema({ disabledMarks, disabledNodes });\n  const LIST_ITEM_TYPE = schema.nodes.list_item;\n  const toggleBlockIfEmpty = (\n    state: EditorState,\n    dispatch: EditorView['dispatch']\n  ) => {\n    let {\n      $from: { parent },\n    } = state.selection;\n    if ([schema.nodes.heading, schema.nodes.code_block].includes(parent.type)) {\n      if (!parent.textContent.length) {\n        setBlockType(schema.nodes.paragraph)(state, dispatch);\n        return true;\n      }\n    }\n\n    return false;\n  };\n\n  const plugins = [\n    history(),\n    keymap({\n      'Mod-z': undo,\n      'Mod-y': redo,\n      Enter: splitListItem(LIST_ITEM_TYPE),\n      Backspace: toggleBlockIfEmpty,\n    }),\n    keymap({\n      'Shift-Enter': exitCode,\n    }),\n    keymap(baseKeymap),\n    pastePlugin(schema, onError),\n    menuPlugin(toolbarItems(schema), onToolbarChange),\n    ...markPlugins(schema),\n    ...nodePlugins(schema),\n    editorPlugin(classes, placeholder),\n  ];\n\n  schema.nodes.code_block &&\n    plugins.push(highlightPlugin({ name: schema.nodes.code_block.name }));\n\n  imageUploadEndpoint &&\n    schema.nodes.image &&\n    plugins.push(\n      placeholderPlugin,\n      imageDropPlugin(imageUploadEndpoint, onError)\n    );\n\n  const editorView = new EditorView(node, {\n    state: EditorState.create({\n      schema,\n      doc: defaultMarkdownParser(schema).parse(value),\n      plugins,\n    }),\n    dispatchTransaction(transation: Transaction) {\n      const newState = editorView.state.apply(transation);\n      editorView.updateState(newState);\n      onChange(defaultMarkdownSerializer.serialize(editorView.state.doc));\n    },\n  });\n\n  return editorView;\n};\n\nexport { createEditorView };\n","import { Plugin } from 'prosemirror-state';\nimport { EditorView } from 'prosemirror-view';\nimport { fileUpload } from './fileUpload';\n\nexport const imageDropPlugin = (\n  endpoint: { url: string; csrfToken: string },\n  onError: (errors: string) => any\n) =>\n  new Plugin({\n    props: {\n      handleDOMEvents: {\n        drop(view: EditorView, event: Event) {\n          const dragEvent = event as DragEvent;\n          if (!dragEvent.dataTransfer) return false;\n          const hasFiles =\n            dragEvent.dataTransfer.files && dragEvent.dataTransfer.files.length;\n          if (!hasFiles) {\n            return false;\n          }\n\n          const images = Array.from(dragEvent.dataTransfer.files).filter(file =>\n            /image/i.test(file.type)\n          );\n\n          if (images.length === 0) {\n            return false;\n          }\n\n          event.preventDefault();\n\n          const coordinates = view.posAtCoords({\n            left: dragEvent.clientX,\n            top: dragEvent.clientY,\n          });\n\n          if (!coordinates) return false;\n\n          return fileUpload(view, images, endpoint, coordinates.pos, onError);\n        },\n      },\n    },\n  });\n"],"names":["Schema","nodes","doc","content","paragraph","group","parseDOM","tag","toDOM","blockquote","horizontal_rule","heading","attrs","level","defining","node","code_block","code","isolating","marks","params","preserveWhitespace","getAttrs","getAttribute","ordered_list","order","tight","dom","hasAttribute","start","bullet_list","list_item","text","image","src","alt","title","draggable","querySelector","hard_break","inline","selectable","em","style","value","strong","test","link","href","inclusive","IGNORED_NODES","IGNORED_TOKENS","MARKDOWN_IT_RULES","fence","hr","defaultMarkdownParser","schema","disabledTokens","disabledNodes","disabledMarks","tokens","omit","initialDefaultMarkdownParser","md","markdownit","html","tokensToDisable","compact","map","t","disable","parser","MarkdownParser","tokenHandlers","paragraph_close","state","length","Mark","none","info","stack","pop","type","create","push","defaultMarkdownSerializer","initialDefaultMarkdownSerializer","write","textContent","ensureNewLine","closeBlock","editorPlugin","classes","placeholder","Plugin","props","attributes","EDITOR_CLASS","pastePlugin","onError","clipboardTextParser","fragment","parse","Slice","maxOpen","transformPastedHTML","includes","markInputRule","regexp","markType","InputRule","match","end","Function","tr","m","markEnd","markStart","matchStart","indexOf","matchEnd","textStart","lastIndexOf","textEnd","nodesBetween","pos","mark","nodeSize","getMarksBetween","filter","item","excludes","addMark","removeStoredMark","markdownLinkInputRule","insertText","nodeIsActive","findSelectedNodeOfType","selection","findParentNode","Object","keys","isActive","hasMarkup","toggleBlockType","toggletype","dispatch","setBlockType","isList","todo_list","toggleList","listType","itemType","range","$from","blockRange","$to","parentList","depth","liftListItem","validContent","setNodeMarkup","wrapInList","Menu","items","editorView","onUpdate","markActive","this","NodeType","from","to","empty","isInSet","storedMarks","rangeHasMark","markIsActive","update","activeItems","_this","i","name","destroy","placeholderPlugin","init","DecorationSet","apply","set","mapping","action","getMeta","add","widget","document","createElement","className","loader","appendChild","deco","Decoration","id","remove","find","undefined","spec","decorations","getState","fileUpload","view","images","endpoint","position","window","confirm","setMeta","setSelection","forEach","found","findPlaceholder","formData","FormData","append","xhr","XMLHttpRequest","withCredentials","open","url","setRequestHeader","csrfToken","onerror","transaction","onload","jsonBody","JSON","response","errors","status","data","replaceWith","send","getDecorations","languages","findBlockNodes","block","startPos","low","highlightAuto","language","relevance","flattenDeep","parseNodes","properties","children","decoration","join","BaseType","getPlugins","_type","keymap","shortcuts","inputRules","rules","getToolbarItem","inToolbar","command","icon","_state","_dispatch","URL_REGEX","MARKDOWN_URL_REGX","MARKS","toggleMark","Node","LEVELS","NODES","lift","wrapIn","wrappingInputRule","paragraphType","l","textblockTypeInputRule","RegExp","listItemType","childCount","menuItems","markToolbarItems","nodeToolbarItems","Icons","Bold","React","viewBox","d","Code","points","CodeBlock","fill","Heading","Image","cx","cy","r","Italic","OrderedList","x","y","width","height","Quote","UnorderedList","Item","onClick","Icon","classNames","ImageUpload","editor","imageUploadEndpoint","accept","onChange","e","target","files","preventDefault","Array","focus","Toolbar","activeOptions","disabledItems","menuItemsToRender","useMemo","key","memo","ContextualHelp","helpText","o","inputRef","editorRef","useRef","useState","setEditor","markdownValue","setMarkdownValue","setActiveOptions","activeOptionsRef","onInputChange","onToolbarChange","options","stringify","current","initEditor","initialSchema","setupSchema","LIST_ITEM_TYPE","plugins","history","undo","redo","Enter","splitListItem","Backspace","parent","exitCode","baseKeymap","toolbarItems","flatMap","markPlugins","nodePlugins","registerLanguage","javascript","python","css","java","PluginKey","_","decorationSet","oldState","docChanged","$head","_view","prevState","highlight","get","lang","highlightPlugin","handleDOMEvents","drop","event","dragEvent","dataTransfer","file","coordinates","posAtCoords","left","clientX","top","clientY","imageDropPlugin","EditorView","EditorState","dispatchTransaction","transation","newState","updateState","serialize","createEditorView","onToolbarClick","useCallback","useEffect","hasPlaceholder","ref"],"mappings":"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"}